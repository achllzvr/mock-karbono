<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/DYNAMIC_STREAK_IMPLEMENTATION.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/DYNAMIC_STREAK_IMPLEMENTATION.md" />
              <option name="updatedContent" value="# ✅ Dynamic Streak Counter - Now Live &amp; Database-Driven!&#10;&#10;##  Build Status: SUCCESS&#10;&#10;The streak counter is now **fully dynamic** and calculates real-time from your database records!&#10;&#10;---&#10;&#10;##  What Changed&#10;&#10;### **Before: Static Placeholder**&#10;```java&#10;private int calculateStreak() {&#10;    return 4; // Always returns 4&#10;}&#10;```&#10;&#10;### **After: Dynamic Database Calculation**&#10;```java&#10;private int calculateStreak() {&#10;    // Checks last 30 days of actual data&#10;    // Counts consecutive days within safe range (0.9 kg/day)&#10;    // Returns real streak number&#10;}&#10;```&#10;&#10;---&#10;&#10;##  How It Works&#10;&#10;### **Streak Logic**&#10;&#10;1. **Start from yesterday** (not today, since today is in progress)&#10;2. **Go backwards day by day** (up to 30 days)&#10;3. **For each day**:&#10;   - Calculate total CO2 (app usage + notifications + appliances)&#10;   - Check if within safe range (≤ 0.9 kg/day)&#10;   - If yes → increment streak&#10;   - If exceeded → break (streak ended)&#10;   - If no data → skip and continue checking&#10;&#10;4. **Return streak count**&#10;&#10;### **Example Scenarios**&#10;&#10;#### **Scenario 1: Perfect Streak**&#10;```&#10;Today: Nov 13 (in progress, not counted)&#10;Nov 12: 0.7 kg ✓ (within range)&#10;Nov 11: 0.8 kg ✓ (within range)&#10;Nov 10: 0.6 kg ✓ (within range)&#10;Nov 9:  0.85 kg ✓ (within range)&#10;&#10;Streak: 4 days&#10;```&#10;&#10;#### **Scenario 2: Broken Streak**&#10;```&#10;Today: Nov 13 (in progress)&#10;Nov 12: 0.7 kg ✓ (within range)&#10;Nov 11: 0.8 kg ✓ (within range)&#10;Nov 10: 1.2 kg ✗ (exceeded!)&#10;Nov 9:  0.6 kg ✓ (doesn't count, streak broken)&#10;&#10;Streak: 2 days&#10;```&#10;&#10;#### **Scenario 3: Days with No Data**&#10;```&#10;Today: Nov 13 (in progress)&#10;Nov 12: 0.7 kg ✓ (within range)&#10;Nov 11: 0.0 kg - (no data, skip)&#10;Nov 10: 0.6 kg ✓ (within range)&#10;Nov 9:  0.8 kg ✓ (within range)&#10;&#10;Streak: 3 days (Nov 12, 10, 9)&#10;```&#10;&#10;#### **Scenario 4: New User**&#10;```&#10;Today: Nov 13 (first day using app)&#10;No previous data&#10;&#10;Streak: 0 days&#10;```&#10;&#10;---&#10;&#10;##  Calculation Details&#10;&#10;### **Daily CO2 Calculation**&#10;```java&#10;For each day:&#10;  1. App Usage CO2&#10;     - Query all AppUsage records for that day&#10;     - Sum estimatedKgCO2&#10;     &#10;  2. Notifications CO2&#10;     - Query all NotificationEvent records for that day&#10;     - Sum estimatedKgCO2&#10;     &#10;  3. Appliances CO2&#10;     - Get all ApplianceLog records&#10;     - Sum estimatedKgCO2PerDay (they apply to every day)&#10;     &#10;  Total = App Usage + Notifications + Appliances&#10;```&#10;&#10;### **Safe Range Check**&#10;```java&#10;Safe Range: 0.9 kg CO2/day&#10;&#10;If (Total &gt; 0 &amp;&amp; Total &lt;= 0.9):&#10;    ✓ Within range - increment streak&#10;    &#10;If (Total &gt; 0.9):&#10;    ✗ Exceeded - break streak&#10;    &#10;If (Total == 0):&#10;    - No data - skip this day, continue checking&#10;```&#10;&#10;### **Helper Methods**&#10;&#10;#### **getDayStartTimestamp()**&#10;```java&#10;// Gets midnight timestamp for a given day&#10;Calendar dayStart = calendar.clone();&#10;dayStart.set(HOUR_OF_DAY, 0);&#10;dayStart.set(MINUTE, 0);&#10;dayStart.set(SECOND, 0);&#10;dayStart.set(MILLISECOND, 0);&#10;return dayStart.getTimeInMillis();&#10;```&#10;&#10;#### **calculateDayCO2()**&#10;```java&#10;// Calculates total CO2 for a specific day range&#10;double dayCO2 = 0.0;&#10;&#10;// App usage between dayStartMs and dayEndMs&#10;// + Notifications between dayStartMs and dayEndMs&#10;// + Appliances (constant per day)&#10;&#10;return dayCO2;&#10;```&#10;&#10;---&#10;&#10;##  Technical Implementation&#10;&#10;### **Performance Optimizations**&#10;&#10;1. **Limited Lookback**: Only checks 30 days (not entire history)&#10;2. **Early Break**: Stops when streak is broken (doesn't check older days)&#10;3. **Background Thread**: Called from executor, doesn't block UI&#10;4. **Exception Handling**: Returns 0 if database errors occur&#10;&#10;### **Database Queries**&#10;```java&#10;// Efficient queries with timestamp filtering&#10;- appUsageDao().getLatest(1000)&#10;  → Filter by timestamp range&#10;  &#10;- notificationEventDao().getAll()&#10;  → Filter by timestamp range&#10;  &#10;- applianceDao().getAll()&#10;  → Applied to every day&#10;```&#10;&#10;### **Edge Cases Handled**&#10;&#10;✅ **No data available**: Returns 0  &#10;✅ **Database errors**: Returns 0 with error logging  &#10;✅ **Days with partial data**: Counted if within range  &#10;✅ **New user**: Returns 0 (no streak yet)  &#10;✅ **Long gaps**: Continues through no-data days  &#10;✅ **Today in progress**: Not counted (streak is for completed days)  &#10;&#10;---&#10;&#10;##  User Experience&#10;&#10;### **Display Updates**&#10;&#10;The streak counter updates automatically when:&#10;- ✅ App opens (onCreate)&#10;- ✅ User returns to dashboard (onResume)&#10;- ✅ Force sync completes (after 2 seconds)&#10;- ✅ New data is recorded&#10;&#10;### **Visual Feedback**&#10;&#10;**Top Stats Bar**:&#10;```&#10; 4   0.18kg   0.45kg   0.15kg&#10;```&#10;&#10;The number next to the fire icon () shows your current streak!&#10;&#10;### **Streak Interpretation**&#10;&#10;| Streak | Meaning |&#10;|--------|---------|&#10;| 0 | No streak (new user or broke streak yesterday) |&#10;| 1 | Yesterday was within safe range |&#10;| 3 | Last 3 days were within safe range |&#10;| 7 | Full week within safe range!  |&#10;| 14 | Two weeks streak!  |&#10;| 30 | Maximum displayed (1 month!)  |&#10;&#10;---&#10;&#10;##  Benefits&#10;&#10;### **Before (Static)**&#10;❌ Always showed &quot;4 days&quot;  &#10;❌ Not motivating (fake number)  &#10;❌ No connection to actual behavior  &#10;❌ Misleading to users  &#10;&#10;### **After (Dynamic)**&#10;✅ Shows real achievement  &#10;✅ Motivates sustainable behavior  &#10;✅ Reflects actual low-carbon days  &#10;✅ Accurate and honest  &#10;✅ Gamification that works  &#10;&#10;---&#10;&#10;##  Examples in Action&#10;&#10;### **Week 1: Starting Out**&#10;```&#10;Mon: 0.8 kg ✓&#10;Tue: 1.1 kg ✗ (exceeded)&#10;Wed: 0.7 kg ✓&#10;Thu: 0.6 kg ✓&#10;Fri: 0.9 kg ✓&#10;Sat: 0.85 kg ✓&#10;&#10;Current Streak: 4 days (Wed-Sat)&#10;```&#10;&#10;### **Week 2: Perfect Week**&#10;```&#10;Sun: 0.7 kg ✓&#10;Mon: 0.65 kg ✓&#10;Tue: 0.8 kg ✓&#10;Wed: 0.75 kg ✓&#10;Thu: 0.82 kg ✓&#10;Fri: 0.88 kg ✓&#10;Sat: 0.79 kg ✓&#10;&#10;Current Streak: 11 days (previous 4 + this week's 7)&#10;```&#10;&#10;### **Week 3: Streak Broken**&#10;```&#10;Sun: 0.7 kg ✓&#10;Mon: 1.2 kg ✗ (exceeded!)&#10;Tue: 0.6 kg ✓&#10;&#10;Current Streak: 1 day (only Tuesday counts, Mon broke it)&#10;```&#10;&#10;---&#10;&#10;##  Integration with App&#10;&#10;### **Dashboard Display**&#10;- Streak shown in top stats bar (green background)&#10;- Updates in real-time when data changes&#10;- Always shows most recent streak count&#10;&#10;### **Motivation System**&#10;- Seeing streak grow encourages sustainable habits&#10;- Breaking streak provides feedback to adjust behavior&#10;- Weekly progress circles show visual streak history&#10;&#10;### **Data Flow**&#10;```&#10;User Action (app usage, notifications, appliances)&#10;    ↓&#10;Data saved to Room database&#10;    ↓&#10;Dashboard loads/refreshes&#10;    ↓&#10;calculateStreak() queries database&#10;    ↓&#10;Counts consecutive days ≤ 0.9 kg&#10;    ↓&#10;Updates UI with real streak number&#10;```&#10;&#10;---&#10;&#10;##  Algorithm Details&#10;&#10;### **Pseudocode**&#10;```&#10;function calculateStreak():&#10;    streak = 0&#10;    today = getCurrentDate()&#10;    currentDate = today - 1 day  // Start from yesterday&#10;    &#10;    for i = 0 to 29:  // Check up to 30 days&#10;        dayStart = midnight of currentDate&#10;        dayEnd = 11:59:59 PM of currentDate&#10;        &#10;        totalCO2 = calculateDayCO2(dayStart, dayEnd)&#10;        &#10;        if totalCO2 &gt; 0 AND totalCO2 &lt;= 0.9:&#10;            streak = streak + 1  // Good day!&#10;        else if totalCO2 &gt; 0.9:&#10;            break  // Streak broken, stop checking&#10;        // if totalCO2 == 0, skip (no data), continue&#10;        &#10;        currentDate = currentDate - 1 day&#10;    &#10;    return streak&#10;```&#10;&#10;### **Time Complexity**&#10;- **Best case**: O(1) - Yesterday exceeded, immediate break&#10;- **Worst case**: O(30) - Check all 30 days&#10;- **Average case**: O(7-14) - Most streaks are 1-2 weeks&#10;&#10;### **Space Complexity**&#10;- O(1) - Only stores streak counter&#10;- Database queries handled by Room (cached)&#10;&#10;---&#10;&#10;## ✅ Testing Checklist&#10;&#10;To verify the streak counter works correctly:&#10;&#10;1. **New User**:&#10;   - [ ] Shows 0 on first launch&#10;   &#10;2. **First Day Under Budget**:&#10;   - [ ] Shows 0 today (day not complete)&#10;   - [ ] Shows 1 tomorrow (after midnight)&#10;   &#10;3. **Multiple Days Under Budget**:&#10;   - [ ] Increments by 1 each day&#10;   - [ ] Shows correct count&#10;   &#10;4. **Day Over Budget**:&#10;   - [ ] Resets streak to 0&#10;   - [ ] Next day starts counting from 1&#10;   &#10;5. **Data Refresh**:&#10;   - [ ] Updates when returning to dashboard&#10;   - [ ] Updates after force sync&#10;   &#10;6. **Edge Cases**:&#10;   - [ ] Handles missing data gracefully&#10;   - [ ] Doesn't crash on database errors&#10;   - [ ] Works across date boundaries&#10;&#10;---&#10;&#10;##  Visual Indicators&#10;&#10;### **Top Stats Bar Colors**&#10;- **Green background**: Streak counter area&#10;- **Fire icon** (): Universal streak symbol&#10;- **White text**: Streak number&#10;&#10;### **Streak Badges (Future Enhancement)**&#10;```&#10; 1-6 days: Keep going!&#10; 7-13 days: One week streak!&#10; 14-20 days: Two weeks!&#10; 21-29 days: Three weeks!&#10; 30+ days: Champion!&#10;```&#10;&#10;---&#10;&#10;##  Analytics Potential&#10;&#10;With dynamic streak data, you can:&#10;- Track user engagement&#10;- Identify behavior patterns&#10;- Reward long streaks&#10;- Send encouragement notifications&#10;- Create leaderboards (future)&#10;- Generate progress reports&#10;&#10;---&#10;&#10;##  Future Enhancements&#10;&#10;Possible improvements:&#10;- [ ] Show longest streak ever achieved&#10;- [ ] Streak history graph&#10;- [ ] Streak recovery challenges&#10;- [ ] Share streak on social media&#10;- [ ] Streak milestones (7, 14, 30, 100 days)&#10;- [ ] Push notifications: &quot;Don't break your streak!&quot;&#10;- [ ] Streak freeze feature (1 day over budget forgiven)&#10;&#10;---&#10;&#10;## ✨ Summary&#10;&#10;**Dynamic Streak Counter Now**:&#10;- ✅ Calculates from real database records&#10;- ✅ Checks consecutive days within safe range&#10;- ✅ Updates automatically on data changes&#10;- ✅ Handles edge cases gracefully&#10;- ✅ Motivates sustainable behavior&#10;- ✅ Shows accurate achievement&#10;&#10;**The streak counter is now a true reflection of your low-carbon journey!** &#10;&#10;---&#10;&#10;*Implemented: November 13, 2025*  &#10;*Build Status: SUCCESS* ✅  &#10;*Streak Counter: FULLY DYNAMIC*&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/achllzvr/mockkarbono/ui/adapters/MarketItem.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/achllzvr/mockkarbono/ui/adapters/MarketItem.java" />
              <option name="updatedContent" value="package com.achllzvr.mockkarbono.ui.adapters;&#10;&#10;/**&#10; * MarketItem model class for the Marketplace RecyclerView&#10; */&#10;public class MarketItem {&#10;    private String title;&#10;    private String description;&#10;    private String price;&#10;    private int imageResId;&#10;&#10;    public MarketItem(String title, String description, String price, int imageResId) {&#10;        this.title = title;&#10;        this.description = description;&#10;        this.price = price;&#10;        this.imageResId = imageResId;&#10;    }&#10;&#10;    public String getTitle() {&#10;        return title;&#10;    }&#10;&#10;    public String getDescription() {&#10;        return description;&#10;    }&#10;&#10;    public String getPrice() {&#10;        return price;&#10;    }&#10;&#10;    public int getImageResId() {&#10;        return imageResId;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/achllzvr/mockkarbono/ui/fragments/CommunityFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/achllzvr/mockkarbono/ui/fragments/CommunityFragment.java" />
              <option name="updatedContent" value="package com.achllzvr.mockkarbono.ui.fragments;&#10;&#10;import android.os.Bundle;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.TextView;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import com.achllzvr.mockkarbono.R;&#10;&#10;/**&#10; * Community Fragment - Soft Pop / Duolingo Style&#10; * Displays leaderboard with podium and community forum topics&#10; */&#10;public class CommunityFragment extends Fragment {&#10;&#10;    // Podium views&#10;    private ImageView imgFirstPlace;&#10;    private ImageView imgSecondPlace;&#10;    private ImageView imgThirdPlace;&#10;    private TextView tvFirstName;&#10;    private TextView tvSecondName;&#10;    private TextView tvThirdName;&#10;    private TextView tvFirstScore;&#10;    private TextView tvSecondScore;&#10;    private TextView tvThirdScore;&#10;    private TextView tvYourScore;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_community, container, false);&#10;&#10;        // Bind podium views&#10;        imgFirstPlace = view.findViewById(R.id.imgFirstPlace);&#10;        imgSecondPlace = view.findViewById(R.id.imgSecondPlace);&#10;        imgThirdPlace = view.findViewById(R.id.imgThirdPlace);&#10;        tvFirstName = view.findViewById(R.id.tvFirstName);&#10;        tvSecondName = view.findViewById(R.id.tvSecondName);&#10;        tvThirdName = view.findViewById(R.id.tvThirdName);&#10;        tvFirstScore = view.findViewById(R.id.tvFirstScore);&#10;        tvSecondScore = view.findViewById(R.id.tvSecondScore);&#10;        tvThirdScore = view.findViewById(R.id.tvThirdScore);&#10;        tvYourScore = view.findViewById(R.id.tvYourScore);&#10;&#10;        // Load mock data&#10;        loadMockLeaderboardData();&#10;&#10;        return view;&#10;    }&#10;&#10;    private void loadMockLeaderboardData() {&#10;        // Mock data for the podium - in real app, this would come from Firestore&#10;        tvFirstName.setText(&quot;Juan&quot;);&#10;        tvFirstScore.setText(&quot;3.8 kg&quot;);&#10;        &#10;        tvSecondName.setText(&quot;Maria&quot;);&#10;        tvSecondScore.setText(&quot;4.2 kg&quot;);&#10;        &#10;        tvThirdName.setText(&quot;Anna&quot;);&#10;        tvThirdScore.setText(&quot;4.5 kg&quot;);&#10;&#10;        // Your score&#10;        tvYourScore.setText(&quot;5.8 kg&quot;);&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/achllzvr/mockkarbono/ui/fragments/ProfileFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/achllzvr/mockkarbono/ui/fragments/ProfileFragment.java" />
              <option name="updatedContent" value="package com.achllzvr.mockkarbono.ui.fragments;&#10;&#10;import android.os.Bundle;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.LinearLayout;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import com.achllzvr.mockkarbono.R;&#10;&#10;/**&#10; * Profile Fragment - Soft Pop / Duolingo Style&#10; * Displays user profile, badges, and settings&#10; */&#10;public class ProfileFragment extends Fragment {&#10;&#10;    // Profile views&#10;    private ImageView imgProfileAvatar;&#10;    private TextView tvUsername;&#10;    private TextView tvJoinDate;&#10;&#10;    // Stats views&#10;    private TextView tvStreakStat;&#10;    private TextView tvTreesPlanted;&#10;    private TextView tvCO2Saved;&#10;&#10;    // Settings buttons&#10;    private LinearLayout btnAppPreferences;&#10;    private LinearLayout btnNotificationSettings;&#10;    private LinearLayout btnAbout;&#10;    private TextView btnLogout;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_profile, container, false);&#10;&#10;        // Bind profile views&#10;        imgProfileAvatar = view.findViewById(R.id.imgProfileAvatar);&#10;        tvUsername = view.findViewById(R.id.tvUsername);&#10;        tvJoinDate = view.findViewById(R.id.tvJoinDate);&#10;&#10;        // Bind stats views&#10;        tvStreakStat = view.findViewById(R.id.tvStreakStat);&#10;        tvTreesPlanted = view.findViewById(R.id.tvTreesPlanted);&#10;        tvCO2Saved = view.findViewById(R.id.tvCO2Saved);&#10;&#10;        // Bind settings buttons&#10;        btnAppPreferences = view.findViewById(R.id.btnAppPreferences);&#10;        btnNotificationSettings = view.findViewById(R.id.btnNotificationSettings);&#10;        btnAbout = view.findViewById(R.id.btnAbout);&#10;        btnLogout = view.findViewById(R.id.btnLogout);&#10;&#10;        // Load mock profile data&#10;        loadMockProfileData();&#10;&#10;        // Setup click listeners&#10;        setupClickListeners();&#10;&#10;        return view;&#10;    }&#10;&#10;    private void loadMockProfileData() {&#10;        // Mock data - in real app, this would come from Firebase Auth and Firestore&#10;        tvUsername.setText(&quot;EcoWarrior_PH&quot;);&#10;        tvJoinDate.setText(&quot;Member since Dec 2025&quot;);&#10;        &#10;        // Stats&#10;        tvStreakStat.setText(&quot;12&quot;);&#10;        tvTreesPlanted.setText(&quot;5&quot;);&#10;        tvCO2Saved.setText(&quot;24kg&quot;);&#10;    }&#10;&#10;    private void setupClickListeners() {&#10;        btnAppPreferences.setOnClickListener(v -&gt; {&#10;            Toast.makeText(requireContext(), &quot;Opening App Preferences...&quot;, Toast.LENGTH_SHORT).show();&#10;            // TODO: Navigate to preferences screen&#10;        });&#10;&#10;        btnNotificationSettings.setOnClickListener(v -&gt; {&#10;            Toast.makeText(requireContext(), &quot;Opening Notification Settings...&quot;, Toast.LENGTH_SHORT).show();&#10;            // TODO: Navigate to notification settings&#10;        });&#10;&#10;        btnAbout.setOnClickListener(v -&gt; {&#10;            Toast.makeText(requireContext(), &quot;Karbono v1.0 - Track your carbon footprint&quot;, Toast.LENGTH_SHORT).show();&#10;        });&#10;&#10;        btnLogout.setOnClickListener(v -&gt; {&#10;            Toast.makeText(requireContext(), &quot;Signing out...&quot;, Toast.LENGTH_SHORT).show();&#10;            // TODO: Implement sign out logic&#10;        });&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>